_248‍.x([["addNewUser",()=>addNewUser],["getAllUsers",()=>getAllUsers]]);const fs = require('fs');

let filePath = process.env.DATA_DIR;
let users = {
    allUsers : []
};

setAllUsers();

function setAllUsers() {
    fs.readFile(filePath, (err, data) => {
        if(data.toString()==='')
        return;

        console.log(JSON.parse(data))
        for(const item of JSON.parse(data).allUsers){
            users.allUsers.push(item);
        }


    })
}
       const addNewUser = (user) => {
    if(hasUser(user))
    return;

    users.allUsers.push(user);
    fs.writeFile(filePath, JSON.stringify(users));
}

function hasUser(user){
    allUsers.forEach(e=>{
        if(e.username === user.username) 
        return true;
    })

    return false;
}

       const getAllUsers = () => {
    return users.allUsers;
}