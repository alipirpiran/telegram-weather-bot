let TelegramBot;_b41‍.w("node-telegram-bot-api",[["default",["TelegramBot"],function(v){TelegramBot=v}]]);require('dotenv').config();


const {getWeather} = require('./api/getWeather');
const {getAllCities} = require('./country');
const {createBtn, loadUsersData, isNewUser, getUser} = require('./funcs');
const {addNewUser, getAllUsers} = require('./datas/api');
const {help, info, mainMenuText} = require('./templates/');

class User {
    constructor(){
        this.username;
        this.chat_id;
        this.city_code = -1;
    }
}
let users = getAllUsers();

const TOKEN = process.env.TOKEN;
let bot = new TelegramBot(TOKEN, {
    polling : true
});


_b41‍.g.console.log('all users : ', users);

const callback = {
    CHOOSE_CITY : 'chooseCity',
}

const forms = {
    mainMenu : (cityName) => {
        return {
            reply_markup : {
                inline_keyboard : [
                    [createBtn(`${cityName ? cityName : 'انتخاب شهر'}`, 'test')]
                ]
            }
        }
    }
}


bot.on('message', msg => {
    
});

bot.onText(/\/start/, msg => {
    let chatId = msg.chat.id;
    let name = msg.from.first_name;

    if(isNewUser(chatId, users)){
        let user = new User();
        user.chat_id = chatId;
        user.username = msg.from.username;

        addNewUser(user);
        users.push(user);
    }
    let user = getUser(chatId, users);

    showMainMenu(chatId,name, user.city_code);
})

function showMainMenu(chatId, username, city){
    bot.sendMessage(chatId,mainMenuText(city, username), forms.mainMenu('asdf') );
}
// getWeather(2172797, data => {
//     console.log(data)
// });






